# Aapache Tomcat AJP 任意文件读取/包含漏洞（CVE-2020-1938）



# 漏洞描述

**CVE-2020-1938 漏洞是由长亭科技安全研究员发现的存在于 Tomcat 中的安全漏洞。Tomcat 服务器作一个免费的开放源代码的Web 应用服务器，其安装后会默认开启ajp连接器，方便与其他web服务器通过ajp协议进行交互。**

**该漏洞是由于Tomcat AJP协议存在缺陷而导致，攻击者利用该漏洞可通过构造特定参数，读取服务器webapp下的任意文件，例如可以读取 webapp 配置文件或源代码。若目标服务器同时存在文件上传功能，攻击者可进一步实现远程代码执行。目前，厂商已发布新版本完成漏洞修复。**

# 影响范围

```
Apache Tomcat 6
Apache Tomcat 7 < 7.0.100
Apache Tomcat 8 < 8.5.51
Apache Tomcat 9 < 9.0.31
```

不受影响版本

```
Apache Tomcat = 7.0.100
Apache Tomcat = 8.5.51
Apache Tomcat = 9.0.31
```





# 漏洞复现

成功后访问系统地址

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200801102145706.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTA4NDU1,size_16,color_FFFFFF,t_70)

nmap探测下端口

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200801105334898.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTA4NDU1,size_16,color_FFFFFF,t_70)



# 漏洞Poc

poc地址：https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi

![image-20220716164344185](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220716164344185.png)

利用成功

至此，我们已成功复现CVE-2020-1938漏洞，利用文件包括含漏洞可进一步获得RCE, 可





# 修复方案

临时禁用AJP协议8009端口，在conf/server.xml配置文件中注释掉<Connector port="8009" protocol="AJP/1.3"redirectPort="8443" />；
配置ajp配置中的secretRequired跟secret属性来限制认证；
