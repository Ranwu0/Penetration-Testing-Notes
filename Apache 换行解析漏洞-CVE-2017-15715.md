## Apache HTTPD 换行解析漏洞（CVE-2017-15715）



**Apache HTTPD是一款HTTP服务器，它可以通过mod_php来运行PHP网页。其2.4.0~2.4.29版本中存在一个解析漏洞，在解析PHP时，`1.php\x0A`将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略**

找到上传点：

![image-20210509220924759](https://img-blog.csdnimg.cn/img_convert/20e7948ce3d457aba892ae2594f169b1.png)

尝试发送马儿，回显失败

![image-20210509221308827](https://xiamo11.oss-cn-beijing.aliyuncs.com/image-20210509221308827.png)

进行修改Hex文件内容，将上传的文件名加上0a换行符

![image-20210509221542765](https://xiamo11.oss-cn-beijing.aliyuncs.com/image-20210509221542765.png)

再次发送，上传成功！

![image-20210509221759503](https://xiamo11.oss-cn-beijing.aliyuncs.com/image-20210509221759503.png)

访问shell.php文件，访问时加上%0a  该漏洞会把该文件当成php解析

![image-20210509221903751](https://img-blog.csdnimg.cn/img_convert/840a65e244e90bf6bcfb80185c53adc9.png)





无回显说明文件存在，使用菜刀getshell即可



后端用了黑名单策略，所以shell.php0x0a可以轻松绕过检测，再利用Apache的换行解析漏洞，使得文件可以被成功解析成php文件，从而成功getshell





## 修复建议

升级到最新版本

或将上传的文件重命名为为时间戳+随机数+.jpg的格式并禁用上传文件目录执行脚本权限





















