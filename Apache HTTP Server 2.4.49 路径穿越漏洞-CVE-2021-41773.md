# Apache HTTP Server 2.4.49 路径穿越漏洞（CVE-2021-41773）

Apache HTTP Server是Apache基金会开源的一款流行的HTTP服务器。在其2.4.49版本中，引入了一个路径穿越漏洞，满足下面两个条件的Apache服务器将会受到影响

- 版本等于2.4.49
- 穿越的目录允许被访问

比如配置了`<Directory />Require all granted</Directory>`。（默认情况下是不允许的）

**攻击者利用这个漏洞，可以读取位于apache服务器web目录以外的其他文件，或者读取web目录中的脚本文件源码，或者开启了cgi或cgid的服务器上执行任意命令**



# 漏洞原理

**CVE-2021-41773 是在 Apache HTTP Server 2.4.49中对路径规范化所做的更改中发现了一个缺陷，攻击者可以使用路径遍历攻击将URL映射到预期文档根目录之外的文件，如果文档根目录之外的文件不受要求全部拒绝的保护，则这些请求可能会成功，如果还为这些别名路径启用了CGI脚本，则可以允许远程代码执行**





尝试在URL上构造exp，发现无法直接在页面URL上构造EXP访问



![在这里插入图片描述](https://img-blog.csdnimg.cn/dc03dfc6b3404354a66c8a40d81dc580.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVml0YW1pbmFwcGxl,size_15,color_FFFFFF,t_70,g_se,x_16)

使用linux自带的curl发包工具，构造exp，可以访问成功

可以访问任意路径

![image-20220416162424733](C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20220416162424733.png)



继续构造exp，可以实现RCE远程代码执行

![image-20220416162710744](C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20220416162710744.png)

通过抓包改包来构造exp也成功访问

![image-20220416162931363](C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20220416162931363.png)





可成功访问服务器任意路径

![在这里插入图片描述](https://img-blog.csdnimg.cn/edd7b4963c054d75bd6f9fd7db4ff076.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVml0YW1pbmFwcGxl,size_20,color_FFFFFF,t_70,g_se,x_16)



日志分析：可发现任意路径访问的痕迹

![img](https://img-blog.csdnimg.cn/b59d8ee538e74190b9bf6492d8825f27.png)





