# RCE(远程命令/代码执行)

**RCE漏洞：可以让攻击者直接向后台服务器远程注入操作系统命令或代码，从而控制后台系统，分为代码执行和命令执行**

**代码执行**：分python，java，php，利用注入代码执行在对方服务器上执行恶意代码

**命令执行**：分为windows，linux，利用命令执行在对方服务器上执行一些恶意操作代码



**RCE漏洞利用的两个前提条件：可控的参数，函数漏洞**



![RCE.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1628823541359-475e91f5-4f42-44a6-b59c-7b35fcb644ac.png?x-oss-process=image%2Fresize%2Cw_750%2Climit_0)

**探测方法分为：漏洞扫描工具，公开漏洞如CVE或CMS公开识别的框架漏洞，手工看功能点决定**

# **系统命令执行**

**系统命令执行函数**

```
system()
passthru()
exec()
shell_exec()
popen()
proc_open()
pcntl_exec()
```

**windows管道符，可适用于绕过**

| 管道符 | 作用                                                     | 举例                     |
| ------ | -------------------------------------------------------- | ------------------------ |
| \|     | 直接执行后面的语句                                       | ping 127.0.0.1\|whoami   |
| \|\|   | 前面的语句执行出错则执行后面的语句                       | ping 127.0.0.1\|\|whoami |
| &      | 前面的语句为假则执行后面的语句                           | ping 127.0.0.1&whoami    |
| &&     | 前面的语句为假，直接出错，前面的语句为真，执行后面的语句 | ping 127.0.0.1&&whoami   |

**一般我们是需要用后面的语句来进行攻击，所以首选|，如果被过滤了在考虑其他**



# **代码执行函数**

```
eval()、
assert()、
preg_replace()、
create_function()
array_map()、
call_user_func()、
call_user_func_array()，
array_filter，usort，uasort()
```



# 形成漏洞的原因

**可控变量，函数漏洞**



# 防御手法

**尽量不使用命令执行函数**

**不要让用户控制参数**

**做好检测和过滤**





















